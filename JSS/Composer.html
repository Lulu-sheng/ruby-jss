<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: JSS::Composer
  
    &mdash; The JSS Ruby Gem - access to the CasperSuite API
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!JSS/Composer.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span>
     &raquo; 
    <span class="title">Composer</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: JSS::Composer
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/jss.rb<span class="defines">,<br />
  lib/jss/composer.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This module provides two methods for building very simple Casper-happy .pkg
and .dmg packages for deployment.</p>

<p>Unlike Composer.app from JAMF, this module currently doesn’t offer a way
to do a before/after disk scan and use the differences to build the root
folder from which the package is built. Nor does the module support editing
the pre/post install scripts in .pkgs.</p>

<p>The ‘root folder’, a folder representing the root filesystem of the
target machine where the package will be installed, must already exist and
be fully populated and with correct permissions.</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="PKG_UTIL-constant" class="">PKG_UTIL =
          <div class="docstring">
  <div class="discussion">
    
<p>the apple pkgutil tool</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='rubyid_Pathname constant id'>Pathname</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='string val'>&quot;/usr/sbin/pkgutil&quot;</span>
</pre></dd>
      
        <dt id="PKGBUILD-constant" class="">PKGBUILD =
          <div class="docstring">
  <div class="discussion">
    
<p>The location of the cli tool for making .pkgs</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='rubyid_Pathname constant id'>Pathname</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='string val'>&quot;/usr/bin/pkgbuild&quot;</span>
</pre></dd>
      
        <dt id="PKG_BUNDLE_ID_PFX-constant" class="">PKG_BUNDLE_ID_PFX =
          <div class="docstring">
  <div class="discussion">
    
<p>the default bundle identifier prefix for pkgs</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='string val'>'jss_gem_composer'</span>
</pre></dd>
      
        <dt id="HDI_UTIL-constant" class="">HDI_UTIL =
          <div class="docstring">
  <div class="discussion">
    
<p>Apple’s hdiutil for making dmgs</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='string val'>'/usr/bin/hdiutil'</span>
</pre></dd>
      
        <dt id="DEFAULT_OUT_DIR-constant" class="">DEFAULT_OUT_DIR =
          <div class="docstring">
  <div class="discussion">
    
<p>Where to save the output ?</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='rubyid_Pathname constant id'>Pathname</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='string val'>&quot;/Users/Shared&quot;</span>
</pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mk_dmg-class_method" title="mk_dmg (class method)">+ (Pathname) <strong>mk_dmg</strong>(name, root, out_dir = DEFAULT_OUT_DIR) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Make a casper-happy .dmg out of a root folder, permissions are assumed to
be correct.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mk_pkg-class_method" title="mk_pkg (class method)">+ (Pathname) <strong>mk_pkg</strong>(name, version, root, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Make a casper-happy .pkg out of a root folder, permissions are assumed to
be correct.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="mk_dmg-class_method">
  
    + (<tt><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></tt>) <strong>mk_dmg</strong>(name, root, out_dir = DEFAULT_OUT_DIR) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Make a casper-happy .dmg out of a root folder, permissions are assumed to
be correct.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The name of the .dmg, the suffix will be added if needed</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>root</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the path to the “root folder” representing the root file system of the
target install drive</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>out_dir</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>DEFAULT_OUT_DIR</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the folder in which the .pkg will be created. Defaults to <span class='object_link'><a href="#DEFAULT_OUT_DIR-constant" title="JSS::Composer::DEFAULT_OUT_DIR (constant)">DEFAULT_OUT_DIR</a></span></p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the local path to the new .dmg</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>RuntimeError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


154
155
156
157
158
159
160
161
162
163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/composer.rb', line 154</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_mk_dmg identifier id'>mk_dmg</span><span class='lparen token'>(</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_root identifier id'>root</span><span class='comma token'>,</span> <span class='rubyid_out_dir identifier id'>out_dir</span> <span class='assign token'>=</span> <span class='rubyid_DEFAULT_OUT_DIR constant id'>DEFAULT_OUT_DIR</span><span class='rparen token'>)</span>

  <span class='rubyid_dmg_filename identifier id'>dmg_filename</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{name}.dmg&quot;</span>
  <span class='rubyid_dmg_vol identifier id'>dmg_vol</span> <span class='assign token'>=</span> <span class='rubyid_name identifier id'>name</span>
  <span class='rubyid_dmg_out identifier id'>dmg_out</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{out_dir}/#{dmg_filename}&quot;</span>

  <span class='rubyid_system identifier id'>system</span> <span class='dstring node'>&quot;#{HDI_UTIL} create -volname '#{dmg_vol}' -srcfolder '#{root}' '#{dmg_out}'&quot;</span>

  <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_RuntimeError constant id'>RuntimeError</span><span class='comma token'>,</span> <span class='string val'>&quot;There was an error building the .dmg&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_$? gvar id'>$?</span><span class='dot token'>.</span><span class='rubyid_exitstatus identifier id'>exitstatus</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_Pathname constant id'>Pathname</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_dmg_out identifier id'>dmg_out</span>

<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mk_pkg-class_method">
  
    + (<tt><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></tt>) <strong>mk_pkg</strong>(name, version, root, opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Make a casper-happy .pkg out of a root folder, permissions are assumed to
be correct.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the name of the .pkg. The .pkg suffix will be added if not present</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>version</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the version of the .pkg, needed for building the .pkg</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>root</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the path to the “root folder” representing the root file system of the
target install drive</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the options for building the .pkg</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:bundle_id_prefix</span>
          <span class="type">(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the pkg bundle identifier prefix. e.g. ‘org.some.organization’ or
‘com.pixar.d3’. Defaults to ‘<span class='object_link'><a href="#PKG_BUNDLE_ID_PFX-constant" title="JSS::Composer::PKG_BUNDLE_ID_PFX (constant)">PKG_BUNDLE_ID_PFX</a></span>’. See ‘man
pkgbuild’ for more info</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:out_dir</span>
          <span class="type">(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>he folder in which the .pkg will be created. Defaults to <span class='object_link'><a href="#DEFAULT_OUT_DIR-constant" title="JSS::Composer::DEFAULT_OUT_DIR (constant)">DEFAULT_OUT_DIR</a></span></p>
</div>
          
        </li>
      
        <li>
          <span class="name">:preserve_ownership</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>If true, the owner/group of the rootpath are preserved. Default is false:
they become the pkgbuild/installer “recommended” (root/wheel or
root/admin)</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the local path to the new .pkg</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="NoSuchItemError.html" title="JSS::NoSuchItemError (class)">NoSuchItemError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/composer.rb', line 83</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_mk_pkg identifier id'>mk_pkg</span><span class='lparen token'>(</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_version identifier id'>version</span><span class='comma token'>,</span> <span class='rubyid_root identifier id'>root</span><span class='comma token'>,</span> <span class='rubyid_opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_NoSuchItemError constant id'>NoSuchItemError</span><span class='comma token'>,</span> <span class='string val'>&quot;Missing pkgbuild tool. Please make sure you're running 10.8 or later.&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_PKGBUILD constant id'>PKGBUILD</span><span class='dot token'>.</span><span class='rubyid_executable? fid id'>executable?</span>

  <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:out_dir</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='rubyid_DEFAULT_OUT_DIR constant id'>DEFAULT_OUT_DIR</span>
  <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:bundle_id_prefix</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='rubyid_PKG_BUNDLE_ID_PFX constant id'>PKG_BUNDLE_ID_PFX</span>

  <span class='rubyid_pkg_filename identifier id'>pkg_filename</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{name}.pkg&quot;</span>
  <span class='rubyid_pkg_id identifier id'>pkg_id</span> <span class='assign token'>=</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:bundle_id_prefix</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='string val'>&quot;.&quot;</span> <span class='plus op'>+</span> <span class='rubyid_name identifier id'>name</span>
  <span class='rubyid_pkg_out identifier id'>pkg_out</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{opts[:out_dir]}/#{pkg_filename}&quot;</span>
  <span class='rubyid_pkg_ownership identifier id'>pkg_ownership</span> <span class='assign token'>=</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:preserve_ownership</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='string val'>&quot;preserve&quot;</span> <span class='colon op'>:</span> <span class='string val'>&quot;recommended&quot;</span>


  <span class='comment val'>### first, run 'analyze' to get a 'component plist' in which we can change some settings</span>
  <span class='comment val'>### for any bundles in the root (bundles like .apps, frameworks, plugins, etc..)</span>
  <span class='comment val'>###</span>
  <span class='comment val'>### we edit the settings thus:</span>
  <span class='comment val'>### BundleOverwriteAction = upgrade, totally replace any version current on disk</span>
  <span class='comment val'>### BundleIsVersionChecked = false, allow us to install regardless of what version is currently installed</span>
  <span class='comment val'>### BundleIsRelocatable = false,  if there's a version of this in some other location, Do Not move this one there after installation</span>
  <span class='comment val'>### BundleHasStrictIdentifier = false, don't care if there's something at the install path with a different bundle id.</span>
  <span class='comment val'>###</span>
  <span class='comment val'>### In other words, just install the thing!</span>
  <span class='comment val'>### (see 'man pkgbuild' for more info)</span>
  <span class='comment val'>###</span>
  <span class='comment val'>###</span>
  <span class='rubyid_comp_plist_out identifier id'>comp_plist_out</span> <span class='assign token'>=</span> <span class='rubyid_Pathname constant id'>Pathname</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='dstring node'>&quot;/tmp/#{PKG_BUNDLE_ID_PFX}-#{pkg_filename}.plist&quot;</span>
  <span class='rubyid_system identifier id'>system</span> <span class='dstring node'>&quot;#{PKGBUILD} --analyze --root '#{root}' '#{comp_plist_out}'&quot;</span>
  <span class='rubyid_comp_plist identifier id'>comp_plist</span> <span class='assign token'>=</span> <span class='rubyid_Plist constant id'>Plist</span><span class='dot token'>.</span><span class='rubyid_parse_xml identifier id'>parse_xml</span> <span class='rubyid_comp_plist_out identifier id'>comp_plist_out</span><span class='dot token'>.</span><span class='rubyid_read identifier id'>read</span>

  <span class='comment val'>### if the plist is empty, there are no bundles in the pkg</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_comp_plist identifier id'>comp_plist</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
    <span class='rubyid_comp_plist_arg identifier id'>comp_plist_arg</span> <span class='assign token'>=</span> <span class='string val'>''</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='comment val'>### otherwise, edit the bundle dictionaries</span>
    <span class='rubyid_comp_plist identifier id'>comp_plist</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_bndl identifier id'>bndl</span><span class='bitor op'>|</span>
      <span class='rubyid_bndl identifier id'>bndl</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span> <span class='string val'>&quot;ChildBundles&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_bndl identifier id'>bndl</span><span class='lbrack token'>[</span><span class='string val'>&quot;ChildBundles&quot;</span><span class='rbrack token'>]</span>
      <span class='rubyid_bndl identifier id'>bndl</span><span class='lbrack token'>[</span><span class='string val'>&quot;BundleOverwriteAction&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;upgrade&quot;</span>
      <span class='rubyid_bndl identifier id'>bndl</span><span class='lbrack token'>[</span><span class='string val'>&quot;BundleIsVersionChecked&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
      <span class='rubyid_bndl identifier id'>bndl</span><span class='lbrack token'>[</span><span class='string val'>&quot;BundleIsRelocatable&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
      <span class='rubyid_bndl identifier id'>bndl</span><span class='lbrack token'>[</span><span class='string val'>&quot;BundleHasStrictIdentifier&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='comment val'>### write out the edits</span>
    <span class='rubyid_comp_plist_out identifier id'>comp_plist_out</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>'w'</span><span class='rparen token'>)</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_f identifier id'>f</span><span class='bitor op'>|</span> <span class='rubyid_f identifier id'>f</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span> <span class='rubyid_comp_plist identifier id'>comp_plist</span><span class='dot token'>.</span><span class='rubyid_to_plist identifier id'>to_plist</span><span class='rbrace token'>}</span>
    <span class='rubyid_comp_plist_arg identifier id'>comp_plist_arg</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;--component-plist '#{comp_plist_out}'&quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'>### now build the pkg</span>
  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_system identifier id'>system</span> <span class='dstring node'>&quot;#{PKGBUILD} --identifier '#{pkg_id}' --version '#{version}' --ownership #{pkg_ownership} --install-location / --root '#{root}' #{comp_plist_arg} '#{pkg_out}' &quot;</span>

    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_RuntimeError constant id'>RuntimeError</span><span class='comma token'>,</span> <span class='string val'>&quot;There was an error building the .pkg&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_$? gvar id'>$?</span><span class='dot token'>.</span><span class='rubyid_exitstatus identifier id'>exitstatus</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
  <span class='rubyid_ensure ensure kw'>ensure</span>
    <span class='rubyid_comp_plist_out identifier id'>comp_plist_out</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_comp_plist_out identifier id'>comp_plist_out</span><span class='dot token'>.</span><span class='rubyid_exist? fid id'>exist?</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_return return kw'>return</span> <span class='rubyid_Pathname constant id'>Pathname</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_pkg_out identifier id'>pkg_out</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Oct 17 10:17:00 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-1.8.7).
</div>

  </body>
</html>